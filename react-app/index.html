<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- PWA Meta tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#3b82f6">
  
  <!-- Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <title>Synergia - Plateforme de gestion collaborative</title>
  
  <!-- Prefetch DNS -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//firebaseapp.com">
</head>
<body>
  <div id="root"></div>
  
  <!-- Version et debug -->
  <script>
    // ‚≠ê VERSION TRACKING
    const storedVersion = localStorage.getItem('synergia_app_version');
    if (storedVersion && storedVersion !== '3.5.1') {
      console.log('üîÑ Nouvelle version d√©tect√©e, nettoyage...');
    }
    localStorage.setItem('synergia_app_version', '3.5.1');
    
    // Console welcome
    console.log('%cüöÄ SYNERGIA v3.5.1', 'color: #3b82f6; font-size: 20px; font-weight: bold;');
    console.log('%cCommandes disponibles:', 'color: #10b981; font-weight: bold;');
    console.log('%c‚Ä¢ forceDashboardReload() - Force le rechargement', 'color: #6b7280;');
    console.log('%c‚Ä¢ window.location.reload(true) - Rechargement dur', 'color: #6b7280;');
    
    // ‚≠ê MODE DEBUG - SERVICE WORKER D√âSACTIV√â
    console.log('%cüö´ SERVICE WORKER D√âSACTIV√â POUR DEBUG', 'color: #ef4444; font-size: 16px; font-weight: bold;');
    console.log('%c‚ö†Ô∏è Erreur "TypeError: r is not a function" en cours de r√©solution', 'color: #f59e0b;');
  </script>
  
  <!-- üö® SERVICE WORKER REGISTRATION COMMENT√â POUR DEBUG -->
  <!--
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js', {
          scope: '/',
          updateViaCache: 'none'
        })
        .then(registration => {
          console.log('üì± SW registered:', registration.scope);
          
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            console.log('üîÑ Nouvelle version SW d√©tect√©e');
            
            newWorker?.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                console.log('üì± SW mis √† jour, rechargement...');
                window.location.reload();
              }
            });
          });
          
          registration.update();
          
          setInterval(() => {
            registration.update();
          }, 60000);
        })
        .catch(error => {
          console.log('‚ùå SW registration failed:', error);
        });
      });
    }
  </script>
  -->
  
  <!-- ‚≠ê VERSION TRACKER -->
  <script type="application/json" id="version-info">
    {
      "version": "3.5.1",
      "buildTime": "{{BUILD_TIME}}",
      "features": ["cache-busting", "auto-refresh", "sw-disabled-debug"],
      "debug": true,
      "serviceWorker": false
    }
  </script>
  
  <!-- ‚≠ê FONCTIONS DEBUG GLOBALES -->
  <script>
    // Fonctions de debug disponibles dans la console
    window.forceDashboardReload = () => {
      console.log('üîÑ Force reload dashboard...');
      window.location.href = '/dashboard';
      setTimeout(() => window.location.reload(true), 100);
    };
    
    window.emergencyClean = () => {
      console.log('üö® NETTOYAGE D\'URGENCE...');
      localStorage.clear();
      sessionStorage.clear();
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name));
        });
      }
      console.log('‚úÖ Nettoyage termin√©, rechargement...');
      setTimeout(() => window.location.reload(true), 1000);
    };
    
    window.debugInfo = () => {
      console.log('üîç DEBUG INFO:');
      console.log('- Version:', '3.5.1');
      console.log('- URL:', window.location.href);
      console.log('- Service Worker:', 'D√âSACTIV√â');
      console.log('- LocalStorage keys:', Object.keys(localStorage).length);
      console.log('- User Agent:', navigator.userAgent);
    };
    
    // Logs automatiques
    console.log('‚úÖ Fonctions debug charg√©es: forceDashboardReload(), emergencyClean(), debugInfo()');
  </script>
  
  <!-- ‚≠ê Main App Script -->
  <script type="module" src="/src/index.jsx"></script>
</body>
</html>
